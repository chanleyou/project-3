<%= cl_image_tag(@event.photo_url, class: "img-fluid", style: 'max-height: 300px; object-fit: none; object-position: center; width: 100%') %>

<div class="container">

	<div class="row">
		<div class="col-12">
			<h1 class="display-4 mt-2"><%= @event.title %></h1>
			<p class="my-0"><%= @event.start_date.localtime.strftime("%H:%M%P %a %-d/%-m/%y") %> to <%= @event.end_date.localtime.strftime("%H:%M%P %a %-d/%-m/%y") %></p>
			<p class="mt-0 mb-3">Location: <%= @event.address %> <%= @event.postcode %></p>
			<p><%= @event.description %></p>
			<table class="table">
			<thead class="thead-light">
			<tr>
				<th>Menu</th>
				<th>Description</th>
				<th>Course</th>
				<th>Price</th>
			</tr>
			</thead>
				<tbody>
					<% @event.dishes.each do |dish| %>
						<tr>
						<td><%= dish.name %></td>
						<td><%= dish.description %></td>
						<td><%= dish.course %></td>
						<td>$<%= dish.price %></td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</div>

	<div class="row">
		<div class="col-12">
			<div class="card bg-light p-2">
				<p>Brought to you by <strong><%= link_to @event.chef.name, chef_path(@event.chef) %></strong></p>
				<p><%= @event.chef.description %></p>
			</div>
		</div>
	</div>

	
	<% if current_chef == @event.chef || current_customer %>
		
		<div class="row">

		<div class="col-12 my-3">
			<h3 class="my-0"><% if current_customer && @orders.length > 0 %>Your <% end %>Preorders</h3>
			<% if current_customer %><p class="my-0"><%= link_to 'Preorder', new_event_order_url(@event) %></p><% end %>
		</div>
		
			<% @orders.each do |order| %>

				<div class="col-12 col-sm-6 col-lg-4 col-xl-3">
					<div class="card my-2 p-2 rounded-0 small">

						<p><strong>Order <%= order.id %></strong><br>
						<% if current_chef %>Customer: <%= order.customer.username %><br><% end %>
						Time: <%= order.time.localtime.strftime("%H:%M%P %a %-d/%-m/%y") %><br>
						Total: $<%= order.total %></p>
						
						<ul>
						<% order.orderitems.each do |orderitem| %>
							<li><%=  orderitem.dish.name %> x<%= orderitem.quantity %> @ $<%= orderitem.dish.price %> each</li>
							<% end %>
						</ul>
					
					</div>
				</div>

			<% end %>
		
		</div>
		
	<% end %>
	

	<div class="row">
		<div class="col-12">
		<%= link_to 'Back', events_path %>
		<% if @event.chef == current_chef %>
			<%= link_to 'Edit', edit_event_path(@event) %>
			<%= link_to 'Delete', event_path(@event),
						method: :delete,
						data: { confirm: 'Are you sure you want to delete this event?' } %>
		<% end %>
		</div>
	</div>

</div>

